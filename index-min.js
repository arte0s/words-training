"use strict";global.initDict=(t=>{let e,o=[];const s=document.body.children[1].shadowRoot.getElementById("dict"),r=s.shadowRoot.getElementById("navbar"),n=s.shadowRoot.getElementById("list"),l=()=>{const o=t.dicts.getFinished(e)+t.dicts.getSelected(e),s="Выбрано "+o+global.utils.getWordText(o);zoox.utils.setSlotText(r,"title","span",s)},i=(o,s,r)=>{const i=document.createElement("z-listitem");t.dicts.isFinished(e,o.w)&&i.setAttribute("data-finished",""),t.dicts.isSelected(e,o.w)&&i.setAttribute("data-selected",""),i.addEventListener("liClick",s=>((e,o,s)=>{t.dicts.setSelected(e,o,s),l()})(e,o.w,s.detail)),zoox.utils.setSlotText(i,"number","span",s+1),zoox.utils.setSlotText(i,"word","span",o.w),zoox.utils.setSlotText(i,"translate","span",o.tl.join(", ")),n.insertBefore(i,n.children[r])};return n.addEventListener("listScroll",t=>(({crFr:t,crTo:e,up:s})=>{for(let r=t;r<=e;r++)i(o[r],r,s?r:null);s&&n.setAttribute("data-scroll","")})(t.detail)),n.addEventListener("speak",t=>{document.body.children[1].shadowRoot.getElementById("speaker").setAttribute("text",t.detail)}),Object.freeze({listInit:(s,r=10)=>{n.innerHTML="",o=t.dicts.get(s),e=s,l(),n.setAttribute("data-max",o.length-1),n.setAttribute("data-part",r),n.setAttribute("data-init","")}})}),global.initMain=(()=>{const t=(t,e)=>{const o=t.dicts.getFinished(),s="Изучено "+o+" "+global.utils.getWordText(o);zoox.utils.setSlotText(e,"title","span",s)};let e;const o=(t,e)=>{zoox.utils.setSlotText(e,"word","span",t.w),zoox.utils.setSlotText(e,"transl","span",t.tl.join(", ")),e.style.display=""},s=(o,s,r,n)=>{const l=[];for(let t=0;t<4;t++)l.push(s.getElementById("btn"+t));return l.forEach((s,i)=>s.addEventListener("click",()=>((o,s,r,n,l)=>{console.log("[EVENT] answer");const i=o.dicts.currentWord.getIndex();i===l?(s.setAttribute("ok",""),n[i].setAttribute("correct",""),(e=o.dicts.currentWord.addCount(parseInt(s.getAttribute("count-to"))))&&t(o,r)):(s.setAttribute("error",""),o.dicts.currentWord.clearCount(),n[i].setAttribute("error",""))})(o,n,r,l,i))),l},r=(t,e,o,s)=>{const r=t.dicts.getPack();s&&t.settings.get().sound&&s.setAttribute("text",r.word.w);for(let t=0;t<4;t++)o[t].removeAttribute("correct"),o[t].removeAttribute("error"),o[t].textContent=r.pack[t].transl;console.log("[mark]",e),e.textContent=r.word.w,e.setAttribute("count",r.word.count)},n=(t,s,n,l,i,d)=>{s.addEventListener("counterEnd",()=>((t,s,r,n)=>{s.hasAttribute("ok")?e?(e=!1,o(t.dicts.getNewWord(),n)):s.setAttribute("finish",""):o(t.dicts.currentWord.get(),r)})(t,s,l,i)),s.addEventListener("falldownEnd",()=>{const e=t.dicts.currentWord.getIndex();n[e].setAttribute("error","")}),s.addEventListener("finish",()=>{r(t,s,n,d),s.setAttribute("start","")})};return e=>{const l=document.body.children[1].shadowRoot,i=l.getElementById("main"),d=l.getElementById("speaker"),a=i.shadowRoot,c=a.children[1],g=a.children[2],u=a.children[3],b=a.children[4],h=a.getElementById("navbar"),p=a.getElementById("mark"),w=s(e,i.shadowRoot,h,p);((t,e,o,s,n,l,i)=>{const d=t.settings.get();d.sound&&s.shadowRoot.getElementById("tglSound").setAttribute("checked","checked"),d.colLight?document.body.classList.add("colors-light"):document.body.classList.add("colors-dark"),{ru:()=>{},en:()=>{}}[d.lang]();let a=!1;s.addEventListener("modalClose",e=>{a||(a=!0,r(t,n,l,i),n.setAttribute("start","")),n.removeAttribute("pause"),e.stopPropagation(),s.style.display="none"}),s.shadowRoot.getElementById("btnAbout").addEventListener("click",t=>{t.stopPropagation(),e.style.display="none",o.style.display=""}),s.addEventListener("soundBtnClick",e=>{e.stopPropagation(),t.settings.setSound(!t.settings.get().sound),console.log("[SOUND]",t.settings.get().sound)})})(e,i,l.getElementById("about"),c,p,w,d),n(e,p,w,u,g,d),((t,e,s)=>{s.shadowRoot.getElementById("learn").addEventListener("click",o=>{o.stopPropagation(),t.dicts.setNewWord(),s.style.display="none",e.setAttribute("finish","")}),s.shadowRoot.getElementById("skip").addEventListener("click",e=>{e.stopPropagation(),o(t.dicts.getNewWord(),s)})})(e,p,g),u.addEventListener("modalClose",t=>{t.stopPropagation(),u.style.display="none",p.setAttribute("finish","")}),b.addEventListener("modalClose",t=>{t.stopPropagation(),b.style.display="none"}),window.addEventListener("resize",t=>{p.hasAttribute("pause")||(p.setAttribute("pause",""),c.style.display="")}),document.getElementById("loader").style.display="none",document.getElementById("app").style.display="",t(e,h),r(e,p,w)}})(),global.initSett=((t,e)=>{const o=document.body.children[1].shadowRoot,s=o.getElementById("sett"),r=s.shadowRoot,n=o.getElementById("dict"),l=r.getElementById("btnColors"),i=r.getElementById("verbsChk"),d=r.getElementById("popChk"),a=t.dictsState.get();a.verbs.selected&&i.setAttribute("checked","checked"),a.pop.selected&&d.setAttribute("checked","checked"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{if(!r.getElementById("cbAuto").hasAttribute("checked","checked"))return;t.stopPropagation();const e=document.body.classList;t.matches?(e.remove("colors-light"),e.add("colors-dark")):(e.remove("colors-dark"),e.add("colors-light")),console.log(`Dark mode is ${t.matches?"🌙 on":"☀️ off"}.`)}),l.addEventListener("click",e=>{console.log("[COLORS]"),e.stopPropagation();const o=document.body.classList;o.contains("colors-light")?(o.remove("colors-light"),o.add("colors-dark"),l.children[0].setAttribute("type","moon"),t.settings.setColors(!1)):(o.remove("colors-dark"),o.add("colors-light"),l.children[0].setAttribute("type","sun"),t.settings.setColors(!0))}),r.getElementById("verbBtn").addEventListener("click",t=>{t.stopPropagation(),e.listInit("verbs",10),s.style.display="none",n.style.display=""}),r.getElementById("popBtn").addEventListener("click",t=>{t.stopPropagation(),e.listInit("pop",25),s.style.display="none",n.style.display=""}),i.addEventListener("cbClick",e=>{e.stopPropagation(),t.dictsState.set("verbs",!t.dictsState.get().verbs.selected)}),d.addEventListener("cbClick",e=>{e.stopPropagation(),t.dictsState.set("pop",!t.dictsState.get().pop.selected)})}),global.loadDictAsync=(async t=>{const e=(t,[e,o])=>(t.push(Object.seal({w:e,tl:o.tl.reduce((t,e)=>Array.isArray(e)?t.concat(e):(()=>(t.push(e),t))(),[])})),t);let o=(()=>{const e="dict_"+t,o=global.locStorage.load(e);if(o)return o.map(t=>Object.seal({w:t.word,tl:t.transl}))})();return o||(o=await(async()=>{const s=await fetch("../data/"+t+".json");if(!s.ok)throw new Error("Ошибка HTTP: "+s.status);return o=Object.entries(await s.json()).reduce(e,[])})()),Object.freeze({name:t,obj:Object.freeze({get:()=>o.slice(0)})})}),global.getDictionaries=((t,e)=>{let o,s,r;const n=t=>Math.floor(Math.random()*t),l=t=>t[n(t.length)],i=()=>{let o;return global.utils.safeWhile(()=>(o=(t=>Object.keys(t)[n(Object.keys(t).length)])(t),!1===e.get(o)),10*Object.keys(e.get()).length),Object.freeze({dict:o,word:l(t[o].get()).w,count:0})},d=e=>t[e.dict].get().find(t=>t.w===e.word),a=t=>Object.assign({},t),c=(t,e)=>{const o=Object.assign({},t);return o.dict=e,o.checked=g.isExist(e,t.w),o.finished=global.utils.isFinished(t.count),Object.freeze(o)},g=global.getWordsSelected(i),u=global.getWordsFinished();return Object.freeze({get:e=>t[e].get().map(t=>c(t,e)),getPack:()=>(o=[],global.utils.safeWhile(()=>{const t=(()=>{const t=l(g.get()),e=d(t);return Object.seal({dict:t.dict,word:e,transl:l(e.tl)})})();return((t,e)=>!!t.find(t=>t.word.tl.find(t=>t===e)))(o,t.transl)||o.push(t),o.length<4},999),s=l(o),{pack:o,word:{w:s.word.w,transl:s.word.transl,count:g.getCount(s.dict,s.word.w)}}),getNewWord:()=>a((()=>(global.utils.safeWhile(()=>{let t=i();return!(!g.isExist(t.dict,t.word)&&!u.isExist(t.dict,t.word)&&(r=t,1))},10*g.length),d(r)))()),getFinished:u.getNumber,getSelected:g.getNumber,isFinished:u.isExist,isSelected:g.isExist,isWordCorrect:g.isCorrect,setSelected:(e,o,s)=>{const r=t[e].get().find(t=>t.w===o);return s?g.add(e,o):g.remove(e,o),c(r,e)},setNewWord:()=>{g.add(r.dict,r.word),r=null},currentWord:Object.freeze({get:()=>a(s.word),getIndex:()=>o.findIndex(t=>t.word==s.word),clearCount:()=>g.setCount(s.dict,s.word.w,0),addCount:t=>{if(global.utils.isFinished(t))return g.remove(s.dict,s.word.w),u.add(s.dict,s.word.w),!0;g.setCount(s.dict,s.word.w,t)}})})}),global.getWordsFinished=(()=>{const t=(t=o)=>global.locStorage.save("wt-finish",t),e=(t,e)=>o.find(o=>o.dict===t&&o.word===e),o=global.locStorage.load("wt-finish")||[];return Object.freeze({get:()=>o.slice(0),getNumber:t=>t?o.filter(e=>e.dict===t).length:o.length,isExist:(t,o)=>!!e(t,o),add:(s,r)=>{if(e(s,r))throw new Error("Word "+s+" "+r+" is already exist!");o.push(Object.freeze({dict:s,word:r})),t()},remove:(e,s)=>{const r=o.findIndex(t=>t.dict===e&&t.word===s);if(!(r>-1))throw new Error("Word "+e+" "+s+" is not  exist!");o.splice(r,1),t()}})}),global.getWordsSelected=(t=>{const e=(t=r)=>global.locStorage.save("wt-words",t),o=(t,e)=>r.find(o=>o.dict===t&&o.word===e),s=(t,e)=>r.push({dict:t,word:e,count:0}),r=[];return Array.prototype.push.apply(r,global.locStorage.load("wt-words")),r.length>=10||(global.utils.safeWhile(()=>{const e=t();return r.find(t=>t.dict===e.dict&&t.word===e.word)||s(e.dict,e.word),r.length<10},999),e()),Object.freeze({get:()=>r.slice(0),getNumber:t=>t?r.filter(e=>e.dict===t).length:r.length,getCount:(t,e)=>o(t,e).count,isExist:(t,e)=>!!o(t,e),isCorrect:()=>r.length>=5,setCount:(t,s,r)=>{o(t,s).count=r,e()},add:(t,r)=>{if(o(t,r))throw new Error('Word "'+r+'" in dict "'+t+'" is already exist!');s(t,r),e()},remove:(t,o)=>{const s=r.findIndex(e=>e.dict===t&&e.word===o);if(!(s>-1))throw new Error("Word "+t+" "+o+" is not  exist!");r.splice(s,1),e()}})}),global.getSettings=(()=>{const t=global.locStorage.load("wt-settings")||Object.seal({sound:!0,lang:"ru",colLight:!0}),e=()=>global.locStorage.save("wt-settings",t);return Object.freeze({get:()=>Object.assign({},t),setSound:o=>{t.sound=o,e()},setLang:o=>{t.lang=o,e()},setColors:o=>{t.colLight=o,e()}})}),global.getDictsState=(t=>{const e=(t=o)=>global.locStorage.save("wt-dicts",t),o=global.locStorage.load("wt-dicts")||(()=>{const o={},s=global.locStorage.load("state");return s?Object.keys(s).forEach((t,e)=>o[t]=Object.seal({selected:s[t]})):t.forEach((t,e)=>o[t]=Object.seal({selected:0===e})),e(o),Object.freeze(o)})();return Object.freeze({get:t=>t?o[t].selected:Object.assign({},o),set:(t,s)=>{o[t].selected=s,e()}})}),global.utils=Object.freeze({safeWhile:(t,e)=>{let o=e;for(;!0===t();)if(o--<=0)throw new Error("Dead loop!")},isFinished:t=>t>=150,getWordText:t=>1===t?" слово":t>0&&t<5?" слова":" слов"}),global.locStorage=Object.freeze({save:(t,e)=>window.localStorage.setItem(t,JSON.stringify(e)),load:t=>JSON.parse(window.localStorage.getItem(t))}),global.initModel=(async()=>Promise.all([global.loadDictAsync("verbs"),global.loadDictAsync("pop")]).then(t=>{const e=[],o={};t.forEach(({name:t,obj:s})=>{e.push(t),o[t]=s}),Object.freeze(o),console.log("[data]",o,"[names]",e);const s=global.getDictsState(e);return{settings:global.getSettings(),dictsState:s,dicts:global.getDictionaries(o,s)}}));const zoox={framework:(()=>{const t=(t,e)=>{const o=(t,e)=>(e.push(t),Array.from(t.childNodes).forEach(t=>o(t,e)),e),s=t=>"{{"+t+"}}",r=()=>document.documentElement.getAttribute("lang"),n=(t,e,o)=>t.forEach(t=>{let r=t.initial;Object.entries(e).forEach(e=>r=((t,e,o,s)=>{if(s===o)throw new Error('Template value "'+s+'" and tamplate "'+o+"\"can'text be the same!");const r=((t,e,o)=>{let s;for(;(s=t.search(e))>=0;)t=t.substr(0,s)+o+t.substr(s+e.length);return t})(e,o,s);return r!==e&&(t.nodeValue=r),r})(t.node,r,s(e[0]),e[1][o]))}),l=Object.entries(e).reduce((e,r)=>e.concat(((t,e)=>o(t,[]).filter(t=>t.nodeType===Node.TEXT_NODE).filter(t=>-1!==t.textContent.search(e)).map(t=>({node:t,initial:t.nodeValue})))(t,s(r[0])).filter(t=>!e.find(e=>e.node===t.node))),[]);n(l,e,r()),new MutationObserver(function(t){t.forEach(function(t){"attributes"==t.type&&n(l,e,r())})}).observe(document.documentElement,{attributes:!0})},e=t=>{const e=(new DOMParser).parseFromString(t,"text/html").head;return{template:e.querySelector("template"),style:e.querySelector("style"),script:e.querySelector("script")}},o=({template:e,style:o,module:s},r)=>{return customElements.define(r,class extends HTMLElement{constructor(){super(),this.logic=s&&s.create?s.create(this):{},this.nodes=null}connectedCallback(){const r=this.attachShadow({mode:"open"});if(o&&r.appendChild(o.cloneNode(!0)),e){const o=document.importNode(e.content,!0);s&&s.texts&&t(o,s.texts),r.appendChild(o)}this.logic.listeners&&Object.entries(this.logic.listeners).forEach(([t,e])=>{this.addEventListener(t,e)}),this.logic.connectedCallback&&this.logic.connectedCallback()}static get observedAttributes(){return s&&s.observedAttributes?s.observedAttributes():[]}attributeChangedCallback(t,e,o){this.logic.attributeChangedCallback&&this.logic.attributeChangedCallback(t,e,o)}}),e?e.content:null};let s;const r=t=>fetch(s+(t=>t.split("-").slice(1).join("/"))(t)+".html").then(t=>t.text()).then(e).then((t=>({template:e,style:o,script:s})=>{const r={module:null,template:e,style:o};if(s){const e=new Blob(['\t//This is code of tag "'+t+'"\n'+s.textContent],{type:"application/javascript"}),o=URL.createObjectURL(e);return import(o).then(t=>(r.module=t.default,r))}return r})(t)).then(e=>o(e,t)).then(t=>t?i(t):null),n=[],l=t=>{if(-1===n.indexOf(t))return n.push(t),!0},i=t=>Promise.all((t=>Array.from(t.querySelectorAll("*")).map(t=>t.tagName.toLowerCase()).filter((t,e,o)=>o.indexOf(t)===e).filter(t=>"z-"===t.slice(0,2)).filter(t=>l(t)).map(t=>r(t)))(t));return Object.freeze({init:(t,e)=>(s=t,window.addEventListener("load",()=>i(document.body,[]).then(e))),load:t=>{if(l(t))return r(t)}})})(),utils:Object.freeze({setSlotText:(t,e,o,s)=>{let r=t.querySelector(o+'[slot="'+e+'"]');r?r.innerHTML="":r=document.createElement(o),r.textContent=s,r.setAttribute("slot",e),t.appendChild(r)}})};