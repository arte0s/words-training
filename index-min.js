"use strict";window.global.initDict=(t=>{let e,o=[];const n=document.body.children[1].shadowRoot.getElementById("dict"),s=n.shadowRoot.getElementById("navbar"),i=n.shadowRoot.getElementById("list"),r=()=>{const o=t.dicts.getFinished(e)+t.dicts.getSelected(e),n="Выбрано "+o+window.global.utils.getWordText(o);window.zoox.utils.setSlotText(s,"title","span",n)},d=(o,n,s)=>{const d=document.createElement("z-listitem");t.dicts.isFinished(e,o.w)&&d.setAttribute("data-finished",""),t.dicts.isSelected(e,o.w)&&d.setAttribute("data-selected",""),d.addEventListener("liClick",n=>((e,o,n)=>{t.dicts.setSelected(e,o,n),r()})(e,o.w,n.detail)),window.zoox.utils.setSlotText(d,"number","span",n+1),window.zoox.utils.setSlotText(d,"word","span",o.w),window.zoox.utils.setSlotText(d,"translate","span",o.tl.join(", ")),i.insertBefore(d,i.children[s])};return i.addEventListener("listScroll",t=>(({crFr:t,crTo:e,up:n})=>{for(let s=t;s<=e;s++)d(o[s],s,n?s:null);n&&i.setAttribute("data-scroll","")})(t.detail)),i.addEventListener("speak",t=>{document.body.children[1].shadowRoot.getElementById("speaker").setAttribute("text",t.detail)}),Object.freeze({listInit:(n,s=10)=>{i.innerHTML="",o=t.dicts.get(n),e=n,r(),i.setAttribute("data-max",o.length-1),i.setAttribute("data-part",s),i.setAttribute("data-init","")}})}),window.global.initMain=(()=>{const t=(t,e)=>{const o=t.dicts.getFinished(),n="Изучено "+o+" "+window.global.utils.getWordText(o);window.zoox.utils.setSlotText(e,"title","span",n)};let e;const o=(t,e)=>{window.zoox.utils.setSlotText(e,"word","span",t.w),window.zoox.utils.setSlotText(e,"transl","span",t.tl.join(", ")),e.style.display=""},n=(o,n,s,i)=>{const r=[];for(let t=0;t<4;t++)r.push(n.getElementById("btn"+t));return r.forEach((n,d)=>n.addEventListener("click",()=>((o,n,s,i,r)=>{console.log("[EVENT] answer");const d=o.dicts.currentWord.getIndex();d===r?(n.setAttribute("ok",""),i[d].setAttribute("correct",""),(e=o.dicts.currentWord.addCount(parseInt(n.getAttribute("count-to"))))&&t(o,s)):(n.setAttribute("error",""),o.dicts.currentWord.clearCount(),i[d].setAttribute("error",""))})(o,i,s,r,d))),r},s=(t,e,o,n)=>{const s=t.dicts.getPack();n&&t.settings.get().sound&&n.setAttribute("text",s.word.w);for(let t=0;t<4;t++)o[t].removeAttribute("correct"),o[t].removeAttribute("error"),o[t].textContent=s.pack[t].transl;console.log("[mark]",e),e.textContent=s.word.w,e.setAttribute("count",s.word.count)},i=(t,n,i,r,d,l)=>{n.addEventListener("counterEnd",()=>((t,n,s,i)=>{n.hasAttribute("ok")?e?(e=!1,o(t.dicts.getNewWord(),i)):n.setAttribute("finish",""):o(t.dicts.currentWord.get(),s)})(t,n,r,d)),n.addEventListener("falldownEnd",()=>{const e=t.dicts.currentWord.getIndex();i[e].setAttribute("error","")}),n.addEventListener("finish",()=>{s(t,n,i,l),n.setAttribute("start","")})};return e=>{const r=document.body.children[1].shadowRoot,d=r.getElementById("main"),l=r.getElementById("speaker"),a=d.shadowRoot,c=a.children[1],g=a.children[2],w=a.children[3],u=a.children[4],b=a.getElementById("navbar"),h=a.getElementById("mark"),p=n(e,d.shadowRoot,b,h);((t,e,o,n,i,r,d)=>{const l=t.settings.get();l.sound&&n.shadowRoot.getElementById("tglSound").setAttribute("checked","checked"),l.colLight?document.body.classList.add("colors-light"):document.body.classList.add("colors-dark"),{ru:()=>{},en:()=>{}}[l.lang]();let a=!1;n.addEventListener("modalClose",e=>{a||(a=!0,s(t,i,r,d),i.setAttribute("start","")),i.removeAttribute("pause"),e.stopPropagation(),n.style.display="none"}),n.shadowRoot.getElementById("btnAbout").addEventListener("click",t=>{t.stopPropagation(),e.style.display="none",o.style.display=""}),n.addEventListener("soundBtnClick",e=>{e.stopPropagation(),t.settings.setSound(!t.settings.get().sound),console.log("[SOUND]",t.settings.get().sound)})})(e,d,r.getElementById("about"),c,h,p,l),i(e,h,p,w,g,l),((t,e,n)=>{n.shadowRoot.getElementById("learn").addEventListener("click",o=>{o.stopPropagation(),t.dicts.setNewWord(),n.style.display="none",e.setAttribute("finish","")}),n.shadowRoot.getElementById("skip").addEventListener("click",e=>{e.stopPropagation(),o(t.dicts.getNewWord(),n)})})(e,h,g),w.addEventListener("modalClose",t=>{t.stopPropagation(),w.style.display="none",h.setAttribute("finish","")}),u.addEventListener("modalClose",t=>{t.stopPropagation(),u.style.display="none"}),window.addEventListener("resize",t=>{h.hasAttribute("pause")||(h.setAttribute("pause",""),c.style.display="")}),document.getElementById("loader").style.display="none",document.getElementById("app").style.display="",t(e,b),s(e,h,p)}})(),window.global.initSett=((t,e)=>{const o=document.body.children[1].shadowRoot,n=o.getElementById("sett"),s=n.shadowRoot,i=o.getElementById("dict"),r=s.getElementById("btnColors"),d=s.getElementById("verbsChk"),l=s.getElementById("popChk"),a=t.dictsState.get();a.verbs.selected&&d.setAttribute("checked","checked"),a.pop.selected&&l.setAttribute("checked","checked"),r.addEventListener("click",e=>{console.log("[COLORS]"),e.stopPropagation();const o=document.body.classList;o.contains("colors-light")?(o.remove("colors-light"),o.add("colors-dark"),r.children[0].setAttribute("type","moon"),t.settings.setColors(!1)):(o.remove("colors-dark"),o.add("colors-light"),r.children[0].setAttribute("type","sun"),t.settings.setColors(!0))}),s.getElementById("verbBtn").addEventListener("click",t=>{t.stopPropagation(),e.listInit("verbs",10),n.style.display="none",i.style.display=""}),s.getElementById("popBtn").addEventListener("click",t=>{t.stopPropagation(),e.listInit("pop",25),n.style.display="none",i.style.display=""}),d.addEventListener("cbClick",e=>{e.stopPropagation(),t.dictsState.set("verbs",!t.dictsState.get().verbs.selected)}),l.addEventListener("cbClick",e=>{e.stopPropagation(),t.dictsState.set("pop",!t.dictsState.get().pop.selected)})}),window.global.loadDictAsync=(async t=>{const e=(t,[e,o])=>(t.push(Object.seal({w:e,tl:o.tl.reduce((t,e)=>Array.isArray(e)?t.concat(e):(()=>(t.push(e),t))(),[])})),t);let o=(()=>{const e="dict_"+t,o=window.global.locStorage.load(e);if(o)return o.map(t=>Object.seal({w:t.word,tl:t.transl}))})();return o||(o=await(async()=>{const n=await fetch("./data/"+t+".json");if(!n.ok)throw new Error("Ошибка HTTP: "+n.status);return o=Object.entries(await n.json()).reduce(e,[])})()),Object.freeze({name:t,obj:Object.freeze({get:()=>o.slice(0)})})}),window.global.getDictionaries=((t,e)=>{let o,n,s;const i=t=>Math.floor(Math.random()*t),r=t=>t[i(t.length)],d=()=>{let o;return window.global.utils.safeWhile(()=>(o=(t=>Object.keys(t)[i(Object.keys(t).length)])(t),!1===e.get(o)),10*Object.keys(e.get()).length),Object.freeze({dict:o,word:r(t[o].get()).w,count:0})},l=e=>t[e.dict].get().find(t=>t.w===e.word),a=t=>Object.assign({},t),c=(t,e)=>{const o=Object.assign({},t);return o.dict=e,o.checked=g.isExist(e,t.w),o.finished=window.global.utils.isFinished(t.count),Object.freeze(o)},g=window.global.getWordsSelected(d),w=window.global.getWordsFinished();return Object.freeze({get:e=>t[e].get().map(t=>c(t,e)),getPack:()=>(o=[],window.global.utils.safeWhile(()=>{const t=(()=>{const t=r(g.get()),e=l(t);return Object.seal({dict:t.dict,word:e,transl:r(e.tl)})})();return((t,e)=>!!t.find(t=>t.word.tl.find(t=>t===e)))(o,t.transl)||o.push(t),o.length<4},999),n=r(o),{pack:o,word:{w:n.word.w,transl:n.word.transl,count:g.getCount(n.dict,n.word.w)}}),getNewWord:()=>a((()=>(window.global.utils.safeWhile(()=>{let t=d();return!(!g.isExist(t.dict,t.word)&&!w.isExist(t.dict,t.word)&&(s=t,1))},10*g.length),l(s)))()),getFinished:w.getNumber,getSelected:g.getNumber,isFinished:w.isExist,isSelected:g.isExist,isWordCorrect:g.isCorrect,setSelected:(e,o,n)=>{const s=t[e].get().find(t=>t.w===o);return n?g.add(e,o):g.remove(e,o),c(s,e)},setNewWord:()=>{g.add(s.dict,s.word),s=null},currentWord:Object.freeze({get:()=>a(n.word),getIndex:()=>o.findIndex(t=>t.word==n.word),clearCount:()=>g.setCount(n.dict,n.word.w,0),addCount:t=>{if(window.global.utils.isFinished(t))return g.remove(n.dict,n.word.w),w.add(n.dict,n.word.w),!0;g.setCount(n.dict,n.word.w,t)}})})}),window.global.getWordsFinished=(()=>{const t=(t=o)=>window.global.locStorage.save("wt-finish",t),e=(t,e)=>o.find(o=>o.dict===t&&o.word===e),o=window.global.locStorage.load("wt-finish")||[];return Object.freeze({get:()=>o.slice(0),getNumber:t=>t?o.filter(e=>e.dict===t).length:o.length,isExist:(t,o)=>!!e(t,o),add:(n,s)=>{if(e(n,s))throw new Error("Word "+n+" "+s+" is already exist!");o.push(Object.freeze({dict:n,word:s})),t()},remove:(e,n)=>{const s=o.findIndex(t=>t.dict===e&&t.word===n);if(!(s>-1))throw new Error("Word "+e+" "+n+" is not  exist!");o.splice(s,1),t()}})}),window.global.getWordsSelected=(t=>{const e=(t=s)=>window.global.locStorage.save("wt-words",t),o=(t,e)=>s.find(o=>o.dict===t&&o.word===e),n=(t,e)=>s.push({dict:t,word:e,count:0}),s=[];return Array.prototype.push.apply(s,window.global.locStorage.load("wt-words")),s.length>=10||(window.global.utils.safeWhile(()=>{const e=t();return s.find(t=>t.dict===e.dict&&t.word===e.word)||n(e.dict,e.word),s.length<10},999),e()),Object.freeze({get:()=>s.slice(0),getNumber:t=>t?s.filter(e=>e.dict===t).length:s.length,getCount:(t,e)=>o(t,e).count,isExist:(t,e)=>!!o(t,e),isCorrect:()=>s.length>=5,setCount:(t,n,s)=>{o(t,n).count=s,e()},add:(t,s)=>{if(o(t,s))throw new Error('Word "'+s+'" in dict "'+t+'" is already exist!');n(t,s),e()},remove:(t,o)=>{const n=s.findIndex(e=>e.dict===t&&e.word===o);if(!(n>-1))throw new Error("Word "+t+" "+o+" is not  exist!");s.splice(n,1),e()}})}),window.global.getSettings=(()=>{const t=window.global.locStorage.load("wt-settings")||Object.seal({sound:!0,lang:"ru",colLight:!0}),e=()=>window.global.locStorage.save("wt-settings",t);return Object.freeze({get:()=>Object.assign({},t),setSound:o=>{t.sound=o,e()},setLang:o=>{t.lang=o,e()},setColors:o=>{t.colLight=o,e()}})}),window.global.getDictsState=(t=>{const e=(t=o)=>window.global.locStorage.save("wt-dicts",t),o=window.global.locStorage.load("wt-dicts")||(()=>{const o={},n=window.global.locStorage.load("state");return n?Object.keys(n).forEach((t,e)=>o[t]=Object.seal({selected:n[t]})):t.forEach((t,e)=>o[t]=Object.seal({selected:0===e})),e(o),Object.freeze(o)})();return Object.freeze({get:t=>t?o[t].selected:Object.assign({},o),set:(t,n)=>{o[t].selected=n,e()}})}),window.global.utils=Object.freeze({safeWhile:(t,e)=>{let o=e;for(;!0===t();)if(o--<=0)throw new Error("Dead loop!")},isFinished:t=>t>=150,getWordText:t=>1===t?" слово":t>0&&t<5?" слова":" слов"}),window.global.locStorage=Object.freeze({save:(t,e)=>window.localStorage.setItem(t,JSON.stringify(e)),load:t=>JSON.parse(window.localStorage.getItem(t))}),window.global.initModel=(async()=>Promise.all([window.global.loadDictAsync("verbs"),window.global.loadDictAsync("pop")]).then(t=>{const e=[],o={};t.forEach(({name:t,obj:n})=>{e.push(t),o[t]=n}),Object.freeze(o),console.log("[data]",o,"[names]",e);const n=window.global.getDictsState(e);return{settings:window.global.getSettings(),dictsState:n,dicts:window.global.getDictionaries(o,n)}})),window.zoox={framework:(()=>{const t=(t,e)=>{const o=(t,e)=>(e.push(t),Array.from(t.childNodes).forEach(t=>o(t,e)),e),n=t=>"{{"+t+"}}",s=()=>document.documentElement.getAttribute("lang"),i=(t,e,o)=>t.forEach(t=>{let s=t.initial;Object.entries(e).forEach(e=>s=((t,e,o,n)=>{if(n===o)throw new Error('Template value "'+n+'" and tamplate "'+o+"\"can'text be the same!");const s=((t,e,o)=>{let n;for(;(n=t.search(e))>=0;)t=t.substr(0,n)+o+t.substr(n+e.length);return t})(e,o,n);return s!==e&&(t.nodeValue=s),s})(t.node,s,n(e[0]),e[1][o]))}),r=Object.entries(e).reduce((e,s)=>e.concat(((t,e)=>o(t,[]).filter(t=>t.nodeType===Node.TEXT_NODE).filter(t=>-1!==t.textContent.search(e)).map(t=>({node:t,initial:t.nodeValue})))(t,n(s[0])).filter(t=>!e.find(e=>e.node===t.node))),[]);i(r,e,s()),new MutationObserver(function(t){t.forEach(function(t){"attributes"==t.type&&i(r,e,s())})}).observe(document.documentElement,{attributes:!0})},e=t=>{const e=(new DOMParser).parseFromString(t,"text/html").head;return{template:e.querySelector("template"),style:e.querySelector("style"),script:e.querySelector("script")}},o=({template:e,style:o,module:n},s)=>{return customElements.define(s,class extends HTMLElement{constructor(){super(),this.logic=n&&n.create?n.create(this):{},this.nodes=null}connectedCallback(){const s=this.attachShadow({mode:"open"});if(o&&s.appendChild(o.cloneNode(!0)),e){const o=document.importNode(e.content,!0);n&&n.texts&&t(o,n.texts),s.appendChild(o)}this.logic.listeners&&Object.entries(this.logic.listeners).forEach(([t,e])=>{this.addEventListener(t,e)}),this.logic.connectedCallback&&this.logic.connectedCallback()}static get observedAttributes(){return n&&n.observedAttributes?n.observedAttributes():[]}attributeChangedCallback(t,e,o){this.logic.attributeChangedCallback&&this.logic.attributeChangedCallback(t,e,o)}}),e?e.content:null};let n;const s=t=>fetch(n+(t=>t.split("-").slice(1).join("/"))(t)+".html").then(t=>t.text()).then(e).then((t=>({template:e,style:o,script:n})=>{const s={module:null,template:e,style:o};if(n){const e=new Blob(['\t//This is code of tag "'+t+'"\n'+n.textContent],{type:"application/javascript"}),o=URL.createObjectURL(e);return import(o).then(t=>(s.module=t.default,s))}return s})(t)).then(e=>o(e,t)).then(t=>t?d(t):null),i=[],r=t=>{if(-1===i.indexOf(t))return i.push(t),!0},d=t=>Promise.all((t=>Array.from(t.querySelectorAll("*")).map(t=>t.tagName.toLowerCase()).filter((t,e,o)=>o.indexOf(t)===e).filter(t=>"z-"===t.slice(0,2)).filter(t=>r(t)).map(t=>s(t)))(t));return Object.freeze({init:(t,e)=>(n=t,window.addEventListener("load",()=>d(document.body,[]).then(e))),load:t=>{if(r(t))return s(t)}})})(),utils:Object.freeze({setSlotText:(t,e,o,n)=>{let s=t.querySelector(o+'[slot="'+e+'"]');s?s.innerHTML="":s=document.createElement(o),s.textContent=n,s.setAttribute("slot",e),t.appendChild(s)}})};